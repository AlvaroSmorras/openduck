Bootstrap: docker
From: ubuntu:22.04

%post
    apt-get update
    export DEBIAN_FRONTEND=noninteractive
    cd /opt/
    apt-get -y install git wget g++ locales
    locale-gen en_US.UTF-8
    update-locale LANG=en_US.UTF-8
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh
    bash ~/miniconda.sh -b -p /opt/miniconda
    eval "$(/opt/miniconda/bin/conda shell.bash hook)"
    conda init
    conda install python=3.9
    conda install -c conda-forge mamba
    mamba install numpy=1.23.5 yank=0.25.2 pdbfixer=1.7 openff-toolkit=0.9.0 parmed=3.4.3 cudatoolkit=11.7.0 openmm=7.5  openmmforcefields=0.9.0 ambertools=22.0 seaborn=0.12 -c conda-forge -c defaults
    pip install "openduck @ git+https://github.com/CBDD/openduck.git"
    pip cache purge
    conda clean -a -y
    apt-get clean

%environment
    export PATH=/opt/miniconda/bin/:$PATH
    export LANG=en_US.UTF-8
    export LANGUAGE=en_US:en
    export LC_ALL=en_US.UTF-8

%labels
    AUTHOR Jochem Nelen (jnelen@ucam.edu)
    Version v1